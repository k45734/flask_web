{% extends "base.html" %}
{% block content %}

<div class="container-xl mt-4"> <div class="d-flex justify-content-between align-items-end mb-4 px-2">
        <div>
            <h2 class="fw-bold mb-0 text-dark"><i class="bi bi-cpu-fill text-primary"></i> System Monitor</h2>
            <p class="text-muted small mb-0">서버 상태를 실시간으로 모니터링합니다.</p>
        </div>
        <div class="text-end">
            <span class="badge bg-white text-dark shadow-sm border p-2">
                <i class="bi bi-clock me-1 text-primary"></i> {{test}}
            </span>
        </div>
    </div>

    <div class="row g-4">
        # --- [1. 시스템 사양 카드] ---
        <div class="col-12 col-lg-4 mb-2">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white py-3">
                    <strong class="text-secondary"><i class="bi bi-info-circle me-2"></i>시스템 정보</strong>
                </div>
                <div class="card-body p-0">
                    <table class="table table-sm mb-0 v-middle">
                        <tbody>
                            <tr class="border-light">
                                <td class="ps-3 py-2 text-muted small">버전</td>
                                <td class="pe-3 py-2 text-end">
                                    <span class="badge {{ 'bg-success' if lines == version else 'bg-danger' }}">v{{lines}}</span>
                                    {% if lines != version %}
                                    <button class="btn btn-xs btn-outline-danger ms-1" onclick="location.href='/update_server'">UP</button>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr><td class="ps-3 py-2 text-muted small">OS</td><td class="pe-3 py-2 text-end small">{{oos}}</td></tr>
                            <tr><td class="ps-3 py-2 text-muted small">CPU</td><td class="pe-3 py-2 text-end small">{{oocpu}}</td></tr>
                            <tr><td class="ps-3 py-2 text-muted small">Memory</td><td class="pe-3 py-2 text-end small fw-bold">{{mem_percent.split(' ')[-1]}}</td></tr>
                            <tr><td class="ps-3 py-2 text-muted small">Disk</td><td class="pe-3 py-2 text-end small fw-bold">{{disk_percent.split(' ')[-2]}}</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        # --- [2. 트래픽 상황 카드] ---
        <div class="col-12 col-md-6 col-lg-4 mb-2">
            <div class="card shadow-sm border-0 h-100 bg-primary text-white overflow-hidden">
                <div class="card-header bg-transparent border-0 py-3">
                    <strong><i class="bi bi-graph-up-arrow me-2"></i>트래픽 (Today)</strong>
                </div>
                <div class="card-body d-flex align-items-center justify-content-center pt-0">
                    {% if data %}
                        {% for row in data %} 
                        <div class="w-100 px-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="small opacity-75">Download</span>
                                <span class="fw-bold">{{row['DOWNLOAD'].split(' ')[-1]}}</span>
                            </div>
                            <div class="progress mb-3" style="height: 6px; background: rgba(255,255,255,0.2);">
                                <div class="progress-bar bg-white" style="width: 75%"></div>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span class="small opacity-75">Upload</span>
                                <span class="fw-bold">{{row['UPLOAD'].split(' ')[-1]}}</span>
                            </div>
                            <div class="progress" style="height: 6px; background: rgba(255,255,255,0.2);">
                                <div class="progress-bar bg-info" style="width: 45%"></div>
                            </div>
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class="card-footer bg-transparent border-0 text-center pb-3">
                    <small class="opacity-75">Updated: {{data[0]['DATE'] if data else 'N/A'}}</small>
                </div>
            </div>
        </div>

        # --- [3. 스케줄러 요약 카드] ---
        <div class="col-12 col-md-6 col-lg-4 mb-2">
            <div class="card shadow-sm border-0 h-100 bg-dark text-white">
                <div class="card-header bg-transparent py-3 d-flex justify-content-between align-items-center">
                    <strong><i class="bi bi-calendar-check me-2"></i>스케줄 요약</strong>
                    <span class="badge bg-primary">{{ sch_save|length }} ACTIVE</span>
                </div>
                <div class="card-body py-2">
                    <div class="list-group list-group-flush bg-transparent">
                        {% for row in sch_save[:3] %} <div class="list-group-item bg-transparent text-white border-secondary px-0 py-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="small">{{row['NAME']}}</span>
                                <span class="badge bg-secondary" style="font-size: 0.65rem;">Next Run</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="card-footer bg-transparent border-0 text-center">
                    <small class="text-muted">아래 상세 목록을 확인하세요 ↓</small>
                </div>
            </div>
        </div>
    </div>

    # --- [4. 스케줄러 상세 테이블 (하단에 넓게)] ---
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white py-3">
                    <strong><i class="bi bi-list-task me-2"></i>전체 스케줄러 상세 관리</strong>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover mb-0 text-center align-middle">
                        <thead class="table-light">
                            <tr>
                                <th class="py-3">작업 명칭</th>
                                <th class="py-3">다음 실행 시간</th>
                                <th class="py-3">동작</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in sch_save %} 
                            <tr>
                                <td class="fw-bold text-primary">{{row['NAME']}}</td>
                                <td><code class="text-secondary">{{row['TIME']}}</code></td>
                                <td>
                                    <button class="btn btn-light btn-sm border text-danger" onclick="if(confirm('취소하시겠습니까?')) location.href='cancle/{{ row['NAME'] }}'">
                                        <i class="bi bi-x-circle"></i> 삭제
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* 화면이 아주 클 때(Desktop) 가독성을 위해 최대 너비 제한 */
    @media (min-width: 1400px) {
        .container-xl { max-width: 1200px; } 
    }
    
    .card { border-radius: 16px; transition: transform 0.2s; }
    .card:hover { transform: translateY(-3px); }
    .btn-xs { padding: 0.1rem 0.4rem; font-size: 0.7rem; }
    .v-middle td { vertical-align: middle; }
    .progress { border-radius: 10px; }
</style>

{% endblock %}