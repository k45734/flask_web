<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <title>원격 알리미 서비스 관리</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { background-color: #f8f9fa; font-family: 'Noto Sans KR', sans-serif; padding-top: 70px; }
        .navbar { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .navbar-brand { font-weight: 700; letter-spacing: -1px; }
        .nav-link { font-weight: 500; margin: 0 5px; transition: all 0.2s ease; }
        .dropdown-menu { border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-radius: 10px; }
        
        /* 기존 login.html의 거대한 스타일 계승 */
        .giant-input { width: 100%; height: 60px; font-size: 30px !important; text-align: center; }
        .giant-btn { width: 100%; height: 60px; font-size: 30px !important; }
        
        /* 기존 user_info.html의 테이블 스타일 */
        .tg { border-collapse: collapse; border: 1px gray solid; background: white; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="{{ url_for('main.index') }}">
            <i class="bi bi-robot me-2"></i>ALIM MASTER
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="mainNavbar">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link active" href="{{ url_for('main.index') }}"><i class="bi bi-house-door"></i> 홈</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"><i class="bi bi-grid"></i> 서비스목록</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{{ url_for('sub2.funmom') }}"><i class="bi bi-palette me-2"></i>아이들 색칠공부</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('sub2.news') }}"><i class="bi bi-newspaper me-2"></i>뉴스 알림</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('sub2.weather') }}"><i class="bi bi-cloud-sun me-2"></i>날씨 알림</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('sub2.unse') }}"><i class="bi bi-stars me-2"></i>오늘의 운세</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('sub2.hotdeal') }}"><i class="bi bi-fire me-2"></i>뽐뿌 핫딜</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('sub2.quiz') }}"><i class="bi bi-patch-question me-2"></i>퀴즈 정답</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('sub2.tracking') }}"><i class="bi bi-box-seam me-2"></i>택배 조회</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('nh.index') }}"><i class="bi bi-truck me-2"></i>농협택배 예약</a></li>
                    </ul>
                </li>
                <li class="nav-item"><a class="nav-link text-warning fw-bold" href="{{ url_for('webtoon.index') }}"><i class="bi bi-book"></i> 웹툰마스터</a></li>
            </ul>

            <ul class="navbar-nav">
                {% if session.get('logFlag') %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle bg-white bg-opacity-10 rounded px-3" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-gear-fill me-1"></i> 관리자 시스템
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li class="px-3 py-1 small text-muted">User: {{ session.get('userid') }}</li>
                        <li><a class="dropdown-item" href="{{ url_for('sub3.second') }}"><i class="bi bi-cpu me-2"></i>프로그램 관리</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('sub4.second') }}"><i class="bi bi-reception-4 me-2"></i>재고 관리</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('rclone.second') }}"><i class="bi bi-cloud-upload me-2"></i>RCLONE 동기화</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('main.log') }}"><i class="bi bi-terminal me-2"></i>실시간 로그</a></li>
                        <li><a class="dropdown-item text-danger" href="{{ url_for('main.restart') }}"><i class="bi bi-arrow-clockwise me-2"></i>시스템 재시작</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item fw-bold text-primary" href="#" data-bs-toggle="modal" data-bs-target="#userInfoModal"><i class="bi bi-person-badge me-2"></i>회원정보 수정</a></li>
                        <li><a class="dropdown-item text-secondary" href="/logout"><i class="bi bi-box-arrow-right me-2"></i>로그아웃</a></li>
                    </ul>
                </li>
                {% else %}
                <li class="nav-item">
                    <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#loginModal"><i class="bi bi-box-arrow-in-right"></i> 로그인</a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4">
            <form action="/login_proc" method="POST">
                <center>
                    <h2 class="mb-4">LOGIN</h2>
                    <input type="text" name="user" placeholder="user" class="giant-input mb-2" required><br>
                    <input type="password" name="passwd" placeholder="passwd" class="giant-input mb-3" required><br>
                    <input type="submit" value="로그인" class="btn btn-primary giant-btn">
                </center>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="userInfoModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4">
            <center>
                <h3 class="mb-3">수정</h3>
                <table class="tg w-100">
                    <tr>
                        <td class="p-3">
                            <form action="/user_info_edit_proc" method="POST">
                                <input type='hidden' name='idx' value="{{ edit_idx if edit_idx else session.get('idx') }}">
                                ID : <input type='text' name='user' value="{{ edit_id if edit_id else session.get('userid') }}" class="form-control mb-2">
                                PWD : <input type='password' name='passwd' value="" class="form-control mb-3">
                                <input type='submit' value="수정" class="btn btn-success w-100 mb-3">
                                <input type="button" value="접속자 목록보기" class="btn btn-outline-dark w-100" onclick="location.href='/ip_list'">
                            </form>
                        </td>
                    </tr>
                </table>
            </center>
        </div>
    </div>
</div>

<main class="container py-4">
    {% block content %}{% endblock %}
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

{% if edit_idx %}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        var myModal = new bootstrap.Modal(document.getElementById('userInfoModal'));
        myModal.show();
    });
</script>
{% endif %}

</body>
</html>