{% extends "base.html" %}
{% block content %}
<center>
    <h4 style="margin-top:20px;">웹툰 자동화 시스템 (God Mode)</h4>
    <form method="get">
        <table border="1" style="border-collapse:collapse; border:1px solid #ddd; width:450px; text-align:center;">
            <tr style="height:40px;">
                <th bgcolor="#f2f2f2" width="150">압축 사용</th>
                <td>
                    <select name="compress" style="width:90%;">
                        <option value="1">사용함</option>
                        <option value="0">안함</option>
                    </select>
                </td>
            </tr>
            <tr style="height:40px;">
                <th bgcolor="#f2f2f2">CBZ 변환</th>
                <td>
                    <select name="cbz" style="width:90%;">
                        <option value="1">사용함</option>
                        <option value="0">안함</option>
                    </select>
                </td>
            </tr>
            <tr style="height:40px;">
                <th bgcolor="#f2f2f2">웹툰 종류</th>
                <td>
                    <select name="gbun" style="width:90%;">
                        <option value="adult">성인웹툰</option>
                        <option value="normal">일반웹툰</option>
                    </select>
                </td>
            </tr>
            <tr style="height:40px;">
                <th bgcolor="#f2f2f2">스케줄 주기</th>
                <td><input type="text" name="start_time" value="*/5 * * * *" style="width:90%; border:0; text-align:center;"></td>
            </tr>
            <tr>
                <td colspan="2" style="padding:15px;">
                    <p style="color:gray; font-size:12px;">※ 모든 작업은 백그라운드에서 실행됩니다.</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <input type="submit" value="수집 스케줄 시작" onclick="this.form.action='webtoon_list_sync';">
                        <input type="submit" value="다운 스케줄 시작" onclick="this.form.action='webtoon_down_start';">
                        <input type="submit" value="즉시 다운로드(1회)" onclick="this.form.action='now';">
                        <input type="submit" value="수집 ID/상태 리셋" onclick="return confirmReset(this.form);" style="color:red; font-weight:bold;">
                        
                        <input type="submit" value="📦 기존 DB 데이터 이관" onclick="return confirmMigrate(this.form);" style="background-color:#2c3e50; color:white;">
                        
                        <input type="submit" value="웹툰 목록 관리" onclick="this.form.action='index_list';">
                        <input type="submit" value="수집 현황 보기" onclick="this.form.action='alim_list';">
                    </div>
                </td>
            </tr>
        </table>
    </form>
</center>

<script>
// 수집 ID 및 상태 리셋 확인
function confirmReset(form) {
    if (confirm("텔레그램 수집 번호와 다운로드 기록을 초기화할까요?\n(수집된 5만 건의 목록은 삭제되지 않습니다.)")) {
        form.action = 'db_list_reset';
        return true;
    }
    return false;
}

// 기존 DB 데이터 이관 확인
function confirmMigrate(form) {
    if (confirm("webtoon_new.db의 데이터를 새 멀티 DB로 복사하시겠습니까?\n이 작업은 최초 1회만 권장합니다.")) {
        form.action = 'db_migrate';
        return true;
    }
    return false;
}
</script>
{% endblock %}