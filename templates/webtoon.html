{% extends "base.html" %}
{% block content %}
<center>
    <h4 style="margin-top:20px; color: #2c3e50;">⚡ 웹툰 자동화 시스템 (God Mode) ⚡</h4>
    <form method="get">
        <table border="1" style="border-collapse:collapse; border:1px solid #ddd; width:480px; text-align:center; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
            <tr style="height:45px;">
                <th bgcolor="#f8f9fa" width="160">압축 사용</th>
                <td>
                    <select name="compress" style="width:90%; padding:5px;">
                        <option value="1">사용함 (권장)</option>
                        <option value="0">안함</option>
                    </select>
                </td>
            </tr>
            <tr style="height:45px;">
                <th bgcolor="#f8f9fa">CBZ 변환</th>
                <td>
                    <select name="cbz" style="width:90%; padding:5px;">
                        <option value="1">사용함 (.cbz)</option>
                        <option value="0">안함 (.zip)</option>
                    </select>
                </td>
            </tr>
            <tr style="height:45px;">
                <th bgcolor="#f8f9fa">웹툰 종류</th>
                <td>
                    <select name="gbun" style="width:90%; padding:5px;">
                        <option value="adult">🔞 성인웹툰</option>
                        <option value="normal">😊 일반웹툰</option>
                    </select>
                </td>
            </tr>
            <tr style="height:45px;">
                <th bgcolor="#f8f9fa">스케줄 주기</th>
                <td><input type="text" name="start_time" value="*/5 * * * *" style="width:90%; border:1px solid #ccc; text-align:center; padding:5px;" placeholder="Cron식 입력"></td>
            </tr>
            <tr>
                <td colspan="2" style="padding:20px;">
                    <p style="color:gray; font-size:12px; margin-bottom:15px;">※ 0% 배터리의 신이 지켜보고 계십니다. 모든 작업은 백그라운드에서 실행됩니다.</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="submit" value="🚀 수집 스케줄 시작" onclick="this.form.action='webtoon_list_sync';" style="padding:10px; cursor:pointer;">
                        <input type="submit" value="📥 다운 스케줄 시작" onclick="this.form.action='webtoon_down_start';" style="padding:10px; cursor:pointer;">
                        
                        <input type="submit" value="⚡ 즉시 다운로드(1회)" onclick="this.form.action='now';" style="padding:10px; cursor:pointer; background-color: #e1f5fe;">
                        <input type="submit" value="🧹 DB 용량 최적화" onclick="return confirmVacuum(this.form);" style="padding:10px; cursor:pointer; background-color: #f1f8e9;">
                        
                        <input type="submit" value="📁 웹툰 목록 관리" onclick="this.form.action='index_list';" style="padding:10px; cursor:pointer;">
                        <input type="submit" value="📊 수집 현황 보기" onclick="this.form.action='alim_list';" style="padding:10px; cursor:pointer;">

                        <input type="submit" value="📦 기존 DB 데이터 이관" onclick="return confirmMigrate(this.form);" style="grid-column: span 2; padding:10px; background-color:#2c3e50; color:white; border:none; cursor:pointer;">
                        <input type="submit" value="⚠ 수집 ID/상태 리셋" onclick="return confirmReset(this.form);" style="grid-column: span 2; padding:8px; color:red; font-weight:bold; border:1px solid red; background:none; cursor:pointer;">
                    </div>
                </td>
            </tr>
        </table>
    </form>
</center>

<script>
// 1. DB 최적화 확인
function confirmVacuum(form) {
    if (confirm("DB 용량 최적화를 시작할까요?\n파일 크기를 줄이고 검색 속도를 높입니다.")) {
        form.action = 'db_vacuum';
        return true;
    }
    return false;
}

// 2. 수집 ID 및 상태 리셋 확인
function confirmReset(form) {
    if (confirm("텔레그램 수집 번호와 다운로드 기록을 초기화할까요?\n(수집된 5만 건의 목록 데이터는 보존됩니다.)")) {
        form.action = 'db_list_reset';
        return true;
    }
    return false;
}

// 3. 기존 DB 데이터 이관 확인
function confirmMigrate(form) {
    if (confirm("webtoon_new.db의 데이터를 새 멀티 DB로 복사하시겠습니까?\n이 작업은 최초 1회만 권장합니다.")) {
        form.action = 'db_migrate';
        return true;
    }
    return false;
}
</script>
{% endblock %}